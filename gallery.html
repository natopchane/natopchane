<!DOCTYPE html>

<html lang="ru">
<head>
  <link rel="stylesheet" href="css/mobile-fixes.css?v=1">

<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Галерея — На ТОПчане | Персидский Мир</title>
<link href="css/style.css" rel="stylesheet"/>
<!-- Favicon -->
<link href="images/imagefav.svg" rel="icon" type="image/svg+xml">
<!-- SEO -->
<meta content="Галерея На ТОПчане: свежие фото прямо из альбомов ВКонтакте. Девушки, Парни, Животные, Мистика, Исторические, Фоны, Музыка, Природа, Мульт, Еда, Военные." name="description"/>
<meta content="#F5EFE6" name="theme-color"/>
<script src="https://cdn.tailwindcss.com"></script>
<style>header nav a.active{border-bottom:2px solid currentColor}</style>
</link>
<!-- injected: mobile-menu sitewide CSS -->
<style id="mobile-menu-css">
@media (max-width:768px){
  /* Off-canvas mobile menu */
  #menu{
    position:fixed!important; top:0; left:0;
    height:100vh; width:86vw; max-width:360px;
    background:#fff; box-shadow:2px 0 24px rgba(0,0,0,.18);
    transform:translateX(-100%); transition:transform .3s ease;
    z-index:100001; overflow-y:auto; padding:0;
  }
  #menu.open{ transform:translateX(0); }

  /* Backdrop */
  #menu-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.45); z-index:100000; }

  /* Menu header + list styling */
  #menu .m-menu-head{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;font:700 16px/1.2 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;border-bottom:1px solid #e5e7eb}
  #menu .m-menu-close{width:32px;height:32px;border-radius:10px;border:1px solid #e5e7eB;background:#fff;font-size:18px;line-height:30px;color:#475569}
  #menu .m-menu{list-style:none;margin:0;padding:8px 0}
  #menu .m-menu a{display:block;padding:14px 16px;text-decoration:none;color:#0f172a;font-weight:600;border-bottom:1px solid #e5e7eb}
  #menu .m-menu li:last-child a{border-bottom:none}

  /* Hide side ads on mobile */
  .ad-left, .ad-right, .side-ad, .ad-sticky, .ad-sidebar { display:none!important; }
  iframe[src*="highperformanceformat.com"] { display:none!important; }

  /* Show burger on mobile only */
  #menu-btn{ display:inline-flex !important; }
}
@media (min-width:768px){
  #menu-backdrop{ display:none!important; }
  #menu-btn{ display:none !important; }
}
</style>

</head>
<body class="bg-[#F8F5F0] text-gray-900 font-sans">
<header class="border-b border-gray-200 bg-white">
<div class="w-full px-2 flex justify-between items-center h-16">
<a class="flex items-center gap-2 tracking-tight" href="index.html">
<img alt="На ТОПчане" class="h-8 w-8 object-contain" src="images/logo.png"/>
<span class="font-bold">На ТОПчане</span>
</a>
<!-- Десктоп -->
<nav class="hidden md:flex md:flex-1 justify-center items-center gap-8 whitespace-nowrap">
<a href="index.html">Главная</a>
<a href="news.html">Новости</a>
<a href="ads.html">Реклама</a>
<a href="videos.html">Видео</a>
<a href="gallery.html">Галерея</a>
<a href="biographies.html">Биографии</a>
<a href="music.html">Музыка</a>
<a href="entertainment.html">Развлечения</a>
<a href="products.html">Продукция</a>
<a href="about.html">О нас</a>
<a href="contacts.html">Контакты</a>
</nav>
<button aria-label="Меню" class="md:hidden p-2 text-gray-700 text-2xl" id="menu-btn">☰</button>
</div>
<!-- Мобилка -->
<div class="hidden flex-col gap-4 p-4 bg-gray-100 md:hidden" id="menu">
<a href="index.html">Главная</a>
<a href="news.html">Новости</a>
<a href="ads.html">Реклама</a>
<a href="videos.html">Видео</a>
<a href="gallery.html">Галерея</a>
<a href="biographies.html">Биографии</a>
<a href="music.html">Музыка</a>
<a href="entertainment.html">Развлечения</a>
<a href="products.html">Продукция</a>
<a href="about.html">О нас</a>
<a href="contacts.html">Контакты</a>
</div>
<script>
    // бургер
    document.getElementById('menu-btn')
      ?.addEventListener('click', ()=> document.getElementById('menu')?.classList.toggle('hidden'));

    // авто-подсветка активного пункта (и для index.html, и для /)
    (function(){
      const norm = p => {
        try { p = new URL(p, location.href).pathname; } catch(e){}
        if (p === '/' || p === '' || /\/index\.html$/i.test(p)) return 'index.html';
        return p.split('/').pop();
      };
      const cur = norm(location.pathname).toLowerCase();
      document.querySelectorAll('header nav a, #menu a').forEach(a=>{
        const href = norm(a.getAttribute('href')||'').toLowerCase();
        a.classList.toggle('active', href === cur);
        a.toggleAttribute('aria-current', href === cur);
      });
    })();
  </script>
<style>
.ad-left, .ad-right {
    position: fixed;
    top: 100px;
    z-index: 9999;
}
.ad-left {
    left: 10px;
}
.ad-right {
    right: 10px;
}
</style>
</header>
<style>
  /* Полоска под активным пунктом меню */
  header nav a.active{ border-bottom:2px solid currentColor; padding-bottom:2px; }

  /* Размеры соц-иконок в подвале (чтобы OK не раздувался) */
  footer .soc-row { display:flex; align-items:center; gap:10px; }
  footer .soc-row img { width:20px; height:20px; display:block; }
  @media (max-width:768px){ footer .soc-row img { width:18px; height:18px; } }
</style>
<script>
  document.getElementById('menu-btn').addEventListener('click', () => {
    document.getElementById('menu').classList.toggle('hidden');
  });
</script>
<!-- Контент -->
<section class="max-w-7xl mx-auto p-4 pb-24">
<h1 class="flex items-center text-3xl font-bold mb-6">
<img alt="" class="h-8 w-8 mr-3" src="images/image-sv.svg"/>
    Обложки 
  </h1>
<!-- Панель категорий + More -->
<div class="flex flex-wrap items-center gap-3 mb-4">
<div class="flex gap-3 overflow-x-auto pb-2" id="cat-bar">
<!-- КНОПКИ КАТЕГОРИЙ (привязка к альбомам ВК по имени) -->
<button class="cat-btn px-4 py-2 rounded bg-white hover:bg-gray-100" data-title="ДЕВУШКИ">ДЕВУШКИ</button>
<button class="cat-btn px-4 py-2 rounded bg-white hover:bg-gray-100" data-title="ПАРНИ">ПАРНИ</button>
<button class="cat-btn px-4 py-2 rounded bg-white hover:bg-gray-100" data-title="ЖИВОТНЫЕ">ЖИВОТНЫЕ</button>
<button class="cat-btn px-4 py-2 rounded bg-white hover:bg-gray-100" data-title="МИСТИКА">МИСТИКА</button>
<button class="cat-btn px-4 py-2 rounded bg-white hover:bg-gray-100" data-title="ИСТОРИЧЕСКИЕ">ИСТОРИЧЕСКИЕ</button>
<button class="cat-btn px-4 py-2 rounded bg-white hover:bg-gray-100" data-title="ФОНЫ">ФОНЫ</button>
<button class="cat-btn px-4 py-2 rounded bg-white hover:bg-gray-100" data-title="МУЗЫКА">МУЗЫКА</button>
<button class="cat-btn px-4 py-2 rounded bg-white hover:bg-gray-100" data-title="ПРИРОДА">ПРИРОДА</button>
<button class="cat-btn px-4 py-2 rounded bg-white hover:bg-gray-100" data-title="МУЛЬТ">МУЛЬТ</button>
<button class="cat-btn px-4 py-2 rounded bg-white hover:bg-gray-100" data-title="ЕДА">ЕДА</button>
<button class="cat-btn px-4 py-2 rounded bg-white hover:bg-gray-100" data-title="ВОЕННЫЕ">ВОЕННЫЕ</button>
</div>
<!-- More: при наведении выпадашка -->
<!-- More: при наведении выпадашка (фикс ховера) -->
<div class="relative group before:absolute before:content-[''] before:left-0 before:top-full before:w-full before:h-2">
<button class="px-4 py-2 rounded bg-white hover:bg-gray-100 font-medium">
    БОЛЬШЕ КАТЕГОРИЙ ▾
  </button>
<!-- Меню без зазора: top-full -->
<div class="absolute left-0 top-full hidden group-hover:block bg-white border border-gray-200 rounded-lg shadow-lg overflow-hidden min-w-[260px] z-50">
<a class="block px-4 py-3 hover:bg-gray-50" href="https://vk.com/hd4kfull" rel="noopener" target="_blank">ОБОИ НА РАБОЧИЙ СТОЛ</a>
<a class="block px-4 py-3 hover:bg-gray-50" href="https://vk.com/hdtelefon" rel="noopener" target="_blank">ОБОИ НА ТЕЛЕФОН</a>
</div>
</div>
<!-- Лоадер -->
<div class="hidden text-center py-8 text-gray-500" id="loader">Загрузка…</div>
<!-- Сетка фото -->
<div class="grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4" id="photos"></div>
</div></section>
<!-- Модалка фото со слайдером -->
<div class="hidden fixed inset-0 bg-black/80 z-[9999] flex items-center justify-center" id="lightbox">
<button class="absolute left-4 md:left-8 text-white text-3xl md:text-5xl select-none" id="lb-prev">‹</button>
<div class="relative max-w-6xl w-full mx-4">
<button class="absolute -top-12 right-0 text-white text-3xl md:text-4xl" id="lb-close">×</button>
<img alt="" class="w-full rounded-lg shadow-2xl select-none" id="lb-img" src=""/>
</div>
<button class="absolute right-4 md:right-8 text-white text-3xl md:text-5xl select-none" id="lb-next">›</button>
</div>
<!-- Подвал (как на главной) -->
<footer class="fixed bottom-0 left-0 w-full border-t border-gray-200 bg-white">
<div class="max-w-7xl mx-auto px-4 py-2 text-xs text-gray-500 flex flex-col md:flex-row justify-between items-center gap-2">
<p>© 2025 На ТОПчане. Все права защищены.</p>
<ul class="soc-row">
<li><a aria-label="VK" href="https://vk.com/natopchane" target="_blank"><img alt="VK" src="images/soc/vk.svg"/></a></li>
<li><a aria-label="Telegram" href="https://t.me/na_topchane" target="_blank"><img alt="Telegram" src="images/soc/telegram.svg"/></a></li>
<li><a aria-label="Instagram" href="https://www.instagram.com/natopchane/" target="_blank"><img alt="Instagram" src="images/soc/instagram.svg"/></a></li>
<li><a aria-label="TikTok" href="https://www.tiktok.com/@natopchane" target="_blank"><img alt="TikTok" src="images/soc/tik-tok.svg"/></a></li>
<li><a aria-label="Pinterest" href="https://www.pinterest.com/natopchane/?invite_code=67d18b04667e4a56b03fb7432127235b&amp;sender=1144266355231499314" target="_blank"><img alt="Pinterest" src="images/soc/pinterest.svg"/></a></li>
<li><a aria-label="Rutube" href="https://rutube.ru/channel/49549724/" target="_blank"><img alt="Rutube" src="images/soc/rutube.svg"/></a></li>
<li><a aria-label="Facebook" href="https://www.facebook.com/groups/natopchane/" target="_blank"><img alt="Facebook" src="images/soc/fb.svg"/></a></li>
<li><a aria-label="Dzen" href="https://dzen.ru/natopchane" target="_blank"><img alt="Dzen" src="images/soc/yandex.svg"/></a></li>
<li><a aria-label="YouTube" href="https://www.youtube.com/@natopchane" target="_blank"><img alt="YouTube" src="images/soc/youtube.svg"/></a></li>
<li><a aria-label="OK" href="https://ok.ru/group/70000013841187" target="_blank"><img alt="OK" src="images/soc/ok.svg"/></a></li>
</ul>
<div class="flex flex-wrap gap-3">
<button class="hover:underline" id="terms-btn">Пользовательское соглашение</button>
<button class="hover:underline" id="support-btn">Поддержка</button>
<button class="hover:underline" id="cooperation-btn">Сотрудничество</button>
<button class="hover:underline" id="privacy-btn">Политика конфиденциальности</button>
</div>
</div>
</footer>
<!-- Универсальная модалка футера -->
<div class="fixed inset-0 bg-black/60 hidden z-50 flex items-center justify-center" id="modal-overlay">
<div class="bg-white text-gray-800 max-w-lg w-full mx-4 p-6 rounded-lg relative shadow-lg">
<button class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 text-lg" id="modal-close">×</button>
<h3 class="text-xl font-semibold mb-4" id="modal-title"></h3>
<div class="text-sm leading-relaxed space-y-3 max-h-72 overflow-y-auto" id="modal-content"></div>
</div>
</div>
<script>
/* ====== VK API CONFIG ====== */
/* Твой сервисный ключ (как прислал): */
const VK_TOKEN = '7672b9597672b9597672b9595e754ae337776727672b9591eea75c30dccf29774aa439e';
const VK_API_V = '5.199';

/* Владелец альбомов из ссылок: album-227671500_XXXXXXXX → owner_id = -227671500 */
const OWNER_ID = -227671500;

/* Мапа: КАТЕГОРИЯ → ID альбома */
const CATEGORY_ALBUMS = {
  'МИСТИКА': 308031297,
  'ДЕВУШКИ': 307890041,
  'МУЗЫКА': 308086424,
  'ФОНЫ': 308086367,
  'ПАРНИ': 307890084,
  'ЕДА': 307981661,
  'ИСТОРИЧЕСКИЕ': 307894856,
  'ПРИРОДА': 307890110,
  'ВОЕННЫЕ': 308085599,
  'МУЛЬТ': 307985978,
  'ЖИВОТНЫЕ': 308086218
};

/* ====== UTILS ====== */
const el = id => document.getElementById(id);
const loader = el('loader');
const photosWrap = el('photos');
function normalizeTitle(t=''){ return t.trim().toUpperCase(); }
function bestSize(sizes){
  const order = ['w','z','y','x','m','s'];
  const map = Object.fromEntries((sizes||[]).map(s=>[s.type, s.url || s.src]));
  for(const k of order) if(map[k]) return map[k];
  return sizes?.[sizes.length-1]?.url || '';
}

/* ====== VK JSONP (обход CORS) — всегда с токеном ====== */
(function ensureToken(){
  if (!VK_TOKEN || VK_TOKEN.length < 30) {
    const box = photosWrap || document.body;
    box.innerHTML = '<p class="text-red-600">VK_TOKEN пустой/некорректный. Вставь рабочий сервисный ключ.</p>';
    throw new Error('VK_TOKEN missing');
  }
})();
function vkJSONP(method, params = {}) {
  return new Promise((resolve, reject) => {
    const cb = 'vk_cb_' + Math.random().toString(36).slice(2);
    const qs = new URLSearchParams({ ...params, access_token: VK_TOKEN, v: VK_API_V, callback: cb }).toString();

    const s = document.createElement('script');
    s.src = `https://api.vk.com/method/${method}?${qs}`;
    s.async = true;

    window[cb] = (data) => {
      delete window[cb]; s.remove();
      if (data?.error) reject(new Error(`${data.error.error_msg} (${data.error.error_code})`));
      else resolve(data?.response);
    };
    s.onerror = () => { delete window[cb]; s.remove(); reject(new Error('VK JSONP network error')); };

    document.body.appendChild(s);
  });
}
async function vk(method, params){ return vkJSONP(method, params); }

/* ====== STATE ====== */
let galleryUrls = [];
let galleryIndex = 0;

/* ====== INIT ====== */
async function init(){
  // Клики по категориям → грузим нужный альбом
  document.querySelectorAll('.cat-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const key = normalizeTitle(btn.dataset.title || btn.textContent);
      const albumId = CATEGORY_ALBUMS[key];

      // подсветка активной
      document.querySelectorAll('.cat-btn').forEach(b=>{
        b.classList.remove('bg-blue-100','text-blue-700'); b.classList.add('bg-white');
      });
      btn.classList.add('bg-blue-100','text-blue-700');

      if (albumId) loadAlbum(albumId);
      else photosWrap.innerHTML = `<p class="text-gray-600">Для категории «${btn.textContent}» не указан альбом.</p>`;
    });
  });

  // автозапуск — первая кнопка
  const firstBtn = document.querySelector('.cat-btn');
  if (firstBtn) firstBtn.click();
}

/* ====== ЗАГРУЗКА ФОТО КОНКРЕТНОГО АЛЬБОМА ====== */
async function loadAlbum(albumId){
  loader.classList.remove('hidden');
  photosWrap.innerHTML = '';
  try{
    const r = await vk('photos.get', {
      owner_id: OWNER_ID,
      album_id: albumId,
      rev: 1,
      photo_sizes: 1,
      count: 200
    });

    const items = r?.items || [];
    if (!items.length){
      photosWrap.innerHTML = `<p class="text-gray-600">В этом альбоме пока нет фото.</p>`;
      return;
    }

    // Подготовка данных
    galleryUrls = [];
    galleryPIDs = [];

    photosWrap.innerHTML = items.map((ph, i) => {
      const thumb = bestSize(ph.sizes);
      const pid = `${OWNER_ID}_${albumId}_${ph.id}`; // глобальный ключ счётчика
      const liked = getLiked(pid);                    // локальный лайк

      galleryUrls.push(thumb);
      galleryPIDs.push(pid);

      const alt = (ph.text || 'Фото').replace(/"/g,'&quot;');

      return `
        <div class="group relative cursor-pointer rounded-lg overflow-hidden bg-white shadow-sm hover:shadow-md transition"
             onclick="openLightbox(${i})">
          <img src="${thumb}" alt="${alt}" class="w-full h-full object-cover">
          <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition"></div>

          <!-- Оверлей: сердце + ГЛОБАЛЬНЫЕ просмотры -->
          <div class="absolute bottom-2 left-2 flex items-center gap-2">
            <button class="like-btn w-7 h-7 rounded-full bg-white/90 hover:bg-white text-red-500 text-xs leading-none flex items-center justify-center shadow"
                    data-pid="${pid}" aria-label="Нравится">
              <span class="heart ${liked ? 'opacity-100' : 'opacity-40'}">♥</span>
            </button>
            <div class="flex items-center gap-1 px-2 h-7 rounded-full bg-black/40 text-white text-[11px] leading-none select-none">
              <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              <span class="view-count" data-pid="${pid}">0</span>
            </div>
          </div>
        </div>
      `;
    }).join('');

    // Навесить лайки и подтянуть ГЛОБАЛЬНЫЕ просмотры
initLikesUI(photosWrap);
await hydrateCounts();


  }catch(e){
    console.error(e);
    photosWrap.innerHTML = `<p class="text-red-600">Ошибка загрузки: ${e.message}</p>`;
  }finally{
    loader.classList.add('hidden');
  }
}


// === LIGHTBOX: функции ===
function openLightbox(index){
  galleryIndex = index;
  el('lb-img').src = galleryUrls[galleryIndex];
  el('lightbox').classList.remove('hidden');
  bumpViewForIndex(galleryIndex); // инкремент просмотров
}
function closeLightbox(){
  el('lightbox').classList.add('hidden');
  el('lb-img').src = '';
}
function nextPhoto(){
  if(!galleryUrls.length) return;
  galleryIndex = (galleryIndex + 1) % galleryUrls.length;
  el('lb-img').src = galleryUrls[galleryIndex];
  bumpViewForIndex(galleryIndex);
}
function prevPhoto(){
  if(!galleryUrls.length) return;
  galleryIndex = (galleryIndex - 1 + galleryUrls.length) % galleryUrls.length;
  el('lb-img').src = galleryUrls[galleryIndex];
  bumpViewForIndex(galleryIndex);
}

// === LIGHTBOX: безопасная привязка хэндлеров (перепривязываем на всякий случай)
(function bindLightboxControls(){
  const closeBtn = el('lb-close');
  const nextBtn  = el('lb-next');
  const prevBtn  = el('lb-prev');
  const box      = el('lightbox');

  // если элементы отсутствуют — не падаем
  if (closeBtn){
    closeBtn.onclick = null;
    closeBtn.style.zIndex = '10000';
    closeBtn.style.pointerEvents = 'auto';
    closeBtn.addEventListener('click', closeLightbox);
  }
  if (nextBtn){
    nextBtn.onclick = null;
    nextBtn.style.zIndex = '10000';
    nextBtn.style.pointerEvents = 'auto';
    nextBtn.addEventListener('click', nextPhoto);
  }
  if (prevBtn){
    prevBtn.onclick = null;
    prevBtn.style.zIndex = '10000';
    prevBtn.style.pointerEvents = 'auto';
    prevBtn.addEventListener('click', prevPhoto);
  }
  if (box){
    box.addEventListener('click', (e)=>{ if(e.target.id === 'lightbox') closeLightbox(); });
  }

  // клавиши
  document.addEventListener('keydown', (e)=>{
    const overlay = el('lightbox');
    if (!overlay || overlay.classList.contains('hidden')) return;
    if (e.key === 'Escape') closeLightbox();
    if (e.key === 'ArrowRight') nextPhoto();
    if (e.key === 'ArrowLeft')  prevPhoto();
  });
})();


/* ====== START ====== */
init();

/* ====== GLOBAL COUNTERS with fallback ====== */
const COUNTER_NS = 'natopchane_vk_gallery_v1';
let USE_LOCAL_VIEWS = false;

function lsGet(k, d){ try{ const v = localStorage.getItem(k); return v ? JSON.parse(v) : d; }catch{ return d; } }
function lsSet(k, v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} }

function keyViews(pid){ return `phv:${pid}`; }
function keyLike(pid){ return `phl:${pid}`; }

async function countGet(pid){
  if (USE_LOCAL_VIEWS) return lsGet(keyViews(pid), 0);
  try{
    const r = await fetch(`https://api.countapi.xyz/get/${COUNTER_NS}/${encodeURIComponent(pid)}`);
    if(!r.ok) throw new Error('get failed');
    const j = await r.json();
    return j?.value ?? 0;
  }catch(e){
    USE_LOCAL_VIEWS = true; // переключаемся на локальные
    return lsGet(keyViews(pid), 0);
  }
}
async function countHit(pid){
  if (USE_LOCAL_VIEWS){
    const v = lsGet(keyViews(pid), 0) + 1;
    lsSet(keyViews(pid), v);
    return v;
  }
  try{
    const r = await fetch(`https://api.countapi.xyz/hit/${COUNTER_NS}/${encodeURIComponent(pid)}`);
    if(!r.ok) throw new Error('hit failed');
    const j = await r.json();
    return j?.value ?? 0;
  }catch(e){
    // fallback на локальные
    USE_LOCAL_VIEWS = true;
    const v = lsGet(keyViews(pid), 0) + 1;
    lsSet(keyViews(pid), v);
    return v;
  }
}

let galleryPIDs = []; // PID в том же порядке

async function bumpViewForIndex(i){
  const pid = galleryPIDs[i];
  if(!pid) return;
  const v = await countHit(pid);
  const label = document.querySelector(`.view-count[data-pid="${pid}"]`);
  if (label) label.textContent = v;
}

async function hydrateCounts(){
  const jobs = galleryPIDs.map(async pid=>{
    const v = await countGet(pid);
    const label = document.querySelector(`.view-count[data-pid="${pid}"]`);
    if (label) label.textContent = v;
  });
  await Promise.allSettled(jobs);
}

/* ====== LIKES (локально) ====== */
function getLiked(pid){ return !!lsGet(keyLike(pid), false); }
function toggleLiked(pid){ const nv = !getLiked(pid); lsSet(keyLike(pid), nv); return nv; }
function initLikesUI(container){
  container.querySelectorAll('.like-btn').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      e.stopPropagation();
      const pid = btn.dataset.pid;
      const liked = toggleLiked(pid);
      const heart = btn.querySelector('.heart');
      if (heart){
        heart.classList.toggle('opacity-40', !liked);
        heart.classList.toggle('opacity-100', liked);
      }
    });
  });
}



</script>
<script>
(function(){
  ['terms-btn','support-btn','cooperation-btn','privacy-btn','menu-btn'].forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    const clone = el.cloneNode(true);
    el.parentNode.replaceChild(clone, el);
  });
  const modal=document.getElementById('modal-overlay');
  const title=document.getElementById('modal-title');
  const meta=document.getElementById('modal-meta');
  const content=document.getElementById('modal-content');
  const cover=document.getElementById('article-cover');
  function show(t,html){
    if(!modal||!title||!content) return;
    title.textContent=t; if(meta) meta.textContent='';
    if(cover){ cover.classList.add('hidden'); cover.src=''; }
    content.innerHTML=html; modal.classList.remove('hidden');
  }
  const TERMS=`<p>Используя сайт «На ТОПчане», вы соглашаетесь с правилами:</p>
  <ul class="list-disc pl-5 space-y-1">
    <li>Не размещать незаконный или оскорбительный контент.</li>
    <li>Не использовать сайт для рассылки спама или мошенничества.</li>
    <li>Соблюдать авторские права на публикуемый материал.</li>
    <li>Администрация может изменять условия без предварительного уведомления.</li>
    <li>При несогласии с условиями прекратите использование сайта.</li>
  </ul>`;
  const SUPPORT=`<p>По любым вопросам и предложениям вы можете написать нам:</p>
  <p class="flex items-center gap-2">
    <img src="images/soc/telegram.svg" alt="Telegram" class="w-5 h-5">
    <a href="https://t.me/levakand_pro" target="_blank" class="text-blue-600 hover:underline">Написать в Telegram</a>
  </p>`;
  const COOP=`<p>По вопросам рекламы и совместных проектов свяжитесь с нами:</p>
  <p class="flex items-center gap-2">
    <img src="images/soc/telegram.svg" alt="Telegram" class="w-5 h-5">
    <a href="https://t.me/levakand_pro" target="_blank" class="text-blue-600 hover:underline">Telegram</a>
  </p>
  <p class="flex items-center gap-2">
    <img src="images/soc/gmail.svg" alt="Gmail" class="w-5 h-5">
    <a href="mailto:natopchane@gmail.com" class="text-red-600 hover:underline">natopchane@gmail.com</a>
  </p>`;
  const PRIV=`<p>Мы уважаем вашу конфиденциальность. При использовании сайта «На ТОПчане» мы можем собирать минимальные данные: IP-адрес, cookie, email (при подписке на рассылку).</p>
  <p>Данные используются для улучшения работы сайта, персонализации контента и статистики посещений.</p>
  <p>Мы не передаём ваши данные третьим лицам, кроме случаев, предусмотренных законом.</p>
  <p>Вы можете запросить удаление или изменение своих данных, написав нам на <a class="text-red-600 hover:underline" href="mailto:natopchane@gmail.com">natopchane@gmail.com</a>.</p>
  <p>Изменения политики публикуются на этой странице.</p>`;
  document.getElementById('terms-btn')?.addEventListener('click', ()=> show('Пользовательское соглашение', TERMS));
  document.getElementById('support-btn')?.addEventListener('click', ()=> show('Поддержка', SUPPORT));
  document.getElementById('cooperation-btn')?.addEventListener('click', ()=> show('Сотрудничество и реклама', COOP));
  document.getElementById('privacy-btn')?.addEventListener('click', ()=> show('Политика конфиденциальности', PRIV));
  document.getElementById('menu-btn')?.addEventListener('click', ()=>{
    document.getElementById('menu')?.classList.toggle('hidden');
  });
})();
</script>
<script>
/* FIX: закрытие модалок подвала (X, фон, Esc) */
(function(){
  const modal   = document.getElementById('modal-overlay');
  const content = document.getElementById('modal-content');
  const closeEl = document.getElementById('modal-close');
  if (!modal) return;

  const hide = () => {
    modal.classList.add('hidden');
    if (content) content.innerHTML = ''; // очистка, чтобы не залипало
  };

  // Сброс старых обработчиков и навес новых
  if (closeEl) { const c = closeEl.cloneNode(true); closeEl.replaceWith(c); c.addEventListener('click', hide); }

  // Клик по фону — закрыть
  modal.addEventListener('click', (e)=> { if (e.target === modal) hide(); });

  // Esc — закрыть
  document.addEventListener('keydown', (e)=>{
    if (e.key === 'Escape' && !modal.classList.contains('hidden')) hide();
  });

  // На всякий — запрещаем скролл под модалкой
  const origOverflow = document.body.style.overflow;
  const observer = new MutationObserver(()=>{
    if (modal.classList.contains('hidden')) document.body.style.overflow = origOverflow;
    else document.body.style.overflow = 'hidden';
  });
  observer.observe(modal, { attributes:true, attributeFilter:['class'] });
})();
</script>
<!-- Левый боковой баннер -->
<div class="ad-left">
<script type="text/javascript">
	atOptions = {
		'key' : '4cfa40489284c0efa9eb342e77152cdc',
		'format' : 'iframe',
		'height' : 300,
		'width' : 160,
		'params' : {}
	};
</script>
<script src="//www.highperformanceformat.com/4cfa40489284c0efa9eb342e77152cdc/invoke.js" type="text/javascript"></script>
</div>
<!-- Правый боковой баннер -->
<div class="ad-right">
<script type="text/javascript">
	atOptions = {
		'key' : '766301ab751df8665553f47e1f05709a',
		'format' : 'iframe',
		'height' : 600,
		'width' : 160,
		'params' : {}
	};
</script>
<script src="//www.highperformanceformat.com/766301ab751df8665553f47e1f05709a/invoke.js" type="text/javascript"></script>
</div>

<!-- injected: mobile-menu sitewide bootstrap -->
<script id="mobile-menu-init">
(function(){
  if (window.__mobileMenuBootstrapped) return;
  window.__mobileMenuBootstrapped = true;

  function $(sel, root){ return (root||document).querySelector(sel); }
  function ce(tag, attrs){ var el=document.createElement(tag); if(attrs){ for(var k in attrs){ if(k==='class') el.className=attrs[k]; else el.setAttribute(k, attrs[k]); } } return el; }

  var header = $('header') || document.body;

  // Ensure backdrop
  var backdrop = $('#menu-backdrop'); 
  if(!backdrop){
    backdrop = ce('div', { id:'menu-backdrop', class:'hidden' });
    header.appendChild(backdrop);
  }

  // Ensure menu container
  var menu = $('#menu');
  if(!menu){
    menu = ce('div', { id:'menu', class:'hidden bg-white md:hidden' });
    var head = ce('div', { class:'m-menu-head' });
    head.appendChild(document.createTextNode('Меню'));
    var closeBtn = ce('button', { id:'menuClose', class:'m-menu-close', 'aria-label':'Закрыть' });
    closeBtn.textContent = '×';
    head.appendChild(closeBtn);
    var ul = ce('ul', { class:'m-menu' });

    // Try to mirror desktop nav links
    var navLinks = header.querySelectorAll('nav a');
    if (navLinks && navLinks.length){
      navLinks.forEach(function(a){
        var li = ce('li'); 
        var link = ce('a', { href: a.getAttribute('href')||'#' });
        link.textContent = (a.textContent||'').trim() || a.getAttribute('href')||'#';
        li.appendChild(link); ul.appendChild(li);
      });
    } else {
      // fallback minimal menu
      ['index.html','news.html','videos.html','music.html','gallery.html','contacts.html'].forEach(function(href){
        var li = ce('li'); var link = ce('a', { href: href }); link.textContent = href.replace('.html','');
        li.appendChild(link); ul.appendChild(li);
      });
    }

    menu.appendChild(head); menu.appendChild(ul);
    header.appendChild(menu);
  }

  // Ensure burger
  var btn = $('#menu-btn');
  if(!btn){
    btn = ce('button', { id:'menu-btn', 'aria-label':'Меню' });
    btn.textContent = '☰';
    // Try to place at end of header first row
    header.appendChild(btn);
  }

  var closeBtnEl = $('#menuClose');
  var bd = $('#menu-backdrop');

  function setOpen(state){
    if(state){
      menu.classList.add('open'); menu.classList.remove('hidden');
      if(bd){ bd.classList.remove('hidden'); bd.classList.remove('md:hidden'); }
      document.body.style.overflow='hidden';
      btn.setAttribute('aria-expanded','true');
      try{ btn.textContent='✕'; }catch(e){}
    }else{
      menu.classList.remove('open'); setTimeout(function(){ menu.classList.add('hidden'); }, 300);
      if(bd){ bd.classList.add('hidden'); }
      document.body.style.overflow='';
      btn.setAttribute('aria-expanded','false');
      try{ btn.textContent='☰'; }catch(e){}
    }
  }
  function toggle(){ setOpen(!menu.classList.contains('open')); }

  try{ var clone = btn.cloneNode(true); btn.parentNode.replaceChild(clone, btn); btn = $('#menu-btn'); }catch(e){}

  btn.addEventListener('click', toggle);
  if(bd) bd.addEventListener('click', function(){ setOpen(false); });
  if(closeBtnEl) closeBtnEl.addEventListener('click', function(){ setOpen(false); });
  document.addEventListener('keydown', function(e){ if(e.key==='Escape') setOpen(false); });
})();
</script>
<a href="index.html" class="back-home">На главную</a>

<style>
@media (max-width:768px){
  .back-home{
    position:fixed;
    bottom:20px;
    right:20px;
    z-index:99999;
    background:#0ea5e9;
    color:#fff;
    font-weight:600;
    padding:10px 14px;
    border-radius:12px;
    text-decoration:none;
    box-shadow:0 4px 10px rgba(0,0,0,0.15);
    transition:background 0.2s;
  }
  .back-home:hover{
    background:#0284c7;
  }
}
</style>
<style>
@media (max-width:768px){
  footer { display:none !important; }
}
</style>

</body>
</html>