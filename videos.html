<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Видео — На ТОПчане | Персидский Мир</title>

  <!-- Иконка вкладки -->
  <link rel="icon" type="image/svg+xml" href="images/video-icon.svg">

  <!-- Мета для SEO -->
  <meta name="description" content="Смотрите новые видео На ТОПчане: Шёлковый путь, Поэзия, Музыка, Биографии, PRO TJK, Дастархан, English, Мистика. Автообновление с YouTube.">
  <meta name="keywords" content="На ТОПчане, видео, YouTube, Шёлковый путь, Поэзия, Музыка, Биографии, Дастархан, English, Мистика, PRO TJK">
  <meta name="theme-color" content="#ffffff">

  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-gray-900 font-sans">

<!-- Шапка -->
<header class="border-b border-gray-200 bg-white sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 flex justify-between items-center h-16">
    <div class="flex items-center gap-3">
      <img src="images/logo.png" alt="На ТОПчане" class="h-8">
      <span class="font-semibold text-lg">На ТОПчане</span>
    </div>

    <nav class="hidden md:flex gap-6 text-sm font-medium">
      <a href="index.html" class="hover:text-blue-600 transition">Главная</a>
      <a href="news.html" class="hover:text-blue-600 transition">Новости</a>
      <a href="ads.html" class="hover:text-blue-600 transition">Реклама</a>
      <a href="videos.html" class="border-b-2 border-blue-600 text-blue-600">Видео</a>
      <a href="gallery.html" class="hover:text-blue-600 transition">Галерея</a>
      <a href="biographies.html" class="hover:text-blue-600 transition">Биографии</a>
      <a href="music.html" class="hover:text-blue-600 transition">Музыка</a>
      <a href="fun.html" class="hover:text-blue-600 transition">Развлечения</a>
      <a href="products.html" class="hover:text-blue-600 transition">Продукция</a>
      <a href="about.html" class="hover:text-blue-600 transition">О нас</a>
      <a href="contacts.html" class="hover:text-blue-600 transition">Контакты</a>
    </nav>

    <button id="menu-btn" class="md:hidden p-2 border rounded">☰</button>
  </div>

  <!-- Мобильное меню -->
  <div id="menu" class="hidden md:hidden bg-white border-t border-gray-200">
    <nav class="flex flex-col p-4 gap-2 text-sm font-medium">
      <a href="index.html">Главная</a>
      <a href="news.html">Новости</a>
      <a href="ads.html">Реклама</a>
      <a href="videos.html" class="text-blue-600">Видео</a>
      <a href="gallery.html">Галерея</a>
      <a href="biographies.html">Биографии</a>
      <a href="music.html">Музыка</a>
      <a href="fun.html">Развлечения</a>
      <a href="products.html">Продукция</a>
      <a href="about.html">О нас</a>
      <a href="contacts.html">Контакты</a>
    </nav>
  </div>
</header>

<!-- Скрипт мобильного меню -->
<script>
document.getElementById('menu-btn').addEventListener('click', () => {
  document.getElementById('menu').classList.toggle('hidden');
});
</script>

<!-- Контент -->
<section class="max-w-7xl mx-auto p-4">
  <h1 class="flex items-center text-3xl font-bold mb-6">
    <img src="images/hd.svg" alt="HD" class="h-8 w-8 mr-3">
    Видео
  </h1>

  <!-- Категории -->
  <div class="flex gap-4 overflow-x-auto pb-2 border-b border-gray-200 mb-6">
    <button class="category-btn px-4 py-2 bg-blue-100 text-blue-700 rounded" data-id="PLco-4nDrUoiBaCWSyGrw8ciGvqg3g6_cz">ПОСЛЕДНИЕ</button>
    <button class="category-btn px-4 py-2 bg-gray-100 rounded" data-id="PLco-4nDrUoiDlSbR-ATz2M6DW3w7DC-vb">ПОЭЗИЯ</button>
    <button class="category-btn px-4 py-2 bg-gray-100 rounded" data-id="PLco-4nDrUoiBTH2oOg58KAKQ_aEhqJTT0">ДАСТАРХАН</button>
    <button class="category-btn px-4 py-2 bg-gray-100 rounded" data-id="PLco-4nDrUoiAaJ6MRWOJtTLA9vbau5esq">ШЁЛКОВЫЙ ПУТЬ</button>
    <button class="category-btn px-4 py-2 bg-gray-100 rounded" data-id="PLco-4nDrUoiDdBIfr9Z8vH6HJTYngo89U">БИОГРАФИИ</button>
    <button class="category-btn px-4 py-2 bg-gray-100 rounded" data-id="PLco-4nDrUoiBF84fD90ZZ7I3HWCBd8d-o">МУЗЫКА</button>
    <button class="category-btn px-4 py-2 bg-gray-100 rounded" data-id="PLco-4nDrUoiCj5q3S0p5Yn5hrXOGcgfRd">PRO TJK</button>
    <button class="category-btn px-4 py-2 bg-gray-100 rounded" data-id="PLco-4nDrUoiCMZXvFbVSdO9hIlYdCPI7A">ENGLISH</button>
    <button class="category-btn px-4 py-2 bg-gray-100 rounded" data-id="PLco-4nDrUoiCSe2vR3DYHnLwa1fMCCI5K">МИСТИКА</button>
  </div>

  <!-- Лоадер -->
  <div id="loader" class="text-center py-8 hidden">Загрузка...</div>

  <!-- Видео -->
  <div id="video-grid" class="grid md:grid-cols-4 gap-4"></div>
</section>

<!-- Модальное окно -->
<div id="video-modal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50">
  <div class="bg-black rounded-lg overflow-hidden max-w-3xl w-full relative">
    <button id="close-modal" class="absolute top-2 right-2 text-white text-2xl">&times;</button>
    <iframe id="video-frame" class="w-full aspect-video" src="" allowfullscreen></iframe>
  </div>
</div>

<!-- Скрипт YouTube -->
<script>
const API_KEY = "AIzaSyCNYHO2iBXdgd8Tc_sp2C1F9SqCkJ8n-68"; // твой ключ
const loader = document.getElementById("loader");
const grid = document.getElementById("video-grid");

// ЗАГРУЗКА ВСЕХ ВИДЕО ИЗ ПЛЕЙЛИСТА (пагинация до конца)
async function loadPlaylistVideos(playlistId, btn) {
  loader.classList.remove("hidden");
  grid.innerHTML = "";

  // Подсветка активной категории
  document.querySelectorAll(".category-btn").forEach(b => {
    b.classList.remove("bg-blue-100","text-blue-700");
    b.classList.add("bg-gray-100");
  });
  if (btn) {
    btn.classList.add("bg-blue-100","text-blue-700");
    btn.classList.remove("bg-gray-100");
  }

  const base = "https://www.googleapis.com/youtube/v3/playlistItems";
  const params = new URLSearchParams({
    part: "snippet",
    maxResults: "50", // максимум у YouTube
    playlistId,
    key: API_KEY
  });

  try {
    let pageToken = "";
    let total = 0;

    // Функция отрисовки одной страницы (чтобы не держать огромную строку в памяти)
    const renderPage = (items) => {
      const html = items.map(item => {
        const v = item.snippet || {};
        const vid = v.resourceId?.videoId || "";
        const thumb = v.thumbnails?.medium?.url || v.thumbnails?.default?.url || "";
        const title = (v.title || "").replace(/"/g, '&quot;');
        return `
          <div class="cursor-pointer border rounded overflow-hidden shadow hover:shadow-lg transition" onclick="openModal('${vid}')">
            <img src="${thumb}" alt="${title}" class="w-full">
            <p class="p-2 text-sm">${title}</p>
          </div>
        `;
      }).join("");
      grid.insertAdjacentHTML("beforeend", html);
    };

    // Тянем все страницы
    do {
      const url = `${base}?${params.toString()}${pageToken ? `&pageToken=${pageToken}` : ""}`;
      const res = await fetch(url);
      const data = await res.json();

      if (!res.ok || data.error) {
        console.error("YouTube API error:", data);
        grid.innerHTML = `<p class="text-red-500">Ошибка загрузки: ${data?.error?.message || res.status}</p>`;
        return;
      }

      const items = data.items || [];
      if (items.length) {
        total += items.length;
        renderPage(items);
      }

      pageToken = data.nextPageToken || "";
    } while (pageToken);

    if (total === 0) {
      grid.innerHTML = `<p class="text-gray-500">В этом плейлисте пока нет видео.</p>`;
    }
  } catch (err) {
    console.error(err);
    grid.innerHTML = `<p class="text-red-500">Сеть недоступна или CORS. Проверь ключ и домен.</p>`;
  } finally {
    loader.classList.add("hidden");
  }
}


function openModal(videoId) {
  document.getElementById("video-frame").src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
  document.getElementById("video-modal").classList.remove("hidden");
}

document.getElementById("close-modal").addEventListener("click", () => {
  document.getElementById("video-modal").classList.add("hidden");
  document.getElementById("video-frame").src = "";
});

document.getElementById("video-modal").addEventListener("click", (e) => {
  if (e.target === document.getElementById("video-modal")) {
    document.getElementById("close-modal").click();
  }
});

// вешаем хэндлеры
document.querySelectorAll(".category-btn").forEach(btn => {
  btn.addEventListener("click", () => loadPlaylistVideos(btn.dataset.id, btn));
});

// грузим по умолчанию ГЛАВНЫЙ плейлист (8 видео)
loadPlaylistVideos("PLco-4nDrUoiBaCWSyGrw8ciGvqg3g6_cz", document.querySelector('.category-btn'));
</script>


</body>
</html>
